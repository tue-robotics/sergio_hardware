
### VARIABLES
############ Settings #######################################
var int 	dir 			= 3;			# define direction of motion
var double 	noise_level 	= 0.04;			# bits (0~2000)
var double	ref_velocity 	= 1;			# m/s or rad/s
var int buffersize 			= 16384*4;
var string	FILENAME 		= "03-10-14_FRF_odom_floor"
#############################################################

# Configure settings
var array NOISE_MIN 		= array(-0.0, -0.0, -0.0);
var array 	NOISE_MAX 		= array(0.0, 0.0, 0.0)
NOISE_MIN[dir-1] 			= -noise_level;
NOISE_MAX[dir-1] 			= noise_level;
var array	VELOCITY 		= array(0.0, 0.0, 0.0);
VELOCITY[dir-1] 			= ref_velocity;

	# Part settings
var double 	Ts 				= 0.001
var int 	BODYNUMBER 		= 1

#### STEP COMPONENT ###
loadComponent("IDENTIFICATION_Step","SOURCES::StepSignal")
addPeer("Supervisor","IDENTIFICATION_Step")
setActivity("IDENTIFICATION_Step",0.5*Ts,HighestPriority,ORO_SCHED_RT); #Since this component is not triggered, it runs at a higher frequency to make sure every timestep a new random number is available
IDENTIFICATION_Step.vector_size = 3
IDENTIFICATION_Step.init_value = array(0.0, 0.0, 0.0)
IDENTIFICATION_Step.final_value = VELOCITY; #vx 0.25?, vy 0.25?, vphi 0.5?
IDENTIFICATION_Step.step_time = array(2.0, 2.0, 2.0)
IDENTIFICATION_Step.configure

#### NOISE COMPONENT ###
loadComponent("IDENTIFICATION_Noise","SOURCES::UniformRandomNumber")
addPeer("Supervisor","IDENTIFICATION_Noise")
setActivity("IDENTIFICATION_Noise",0.5*Ts,HighestPriority,ORO_SCHED_RT); #Since this component is not triggered, it runs at a higher frequency to make sure every timestep a new random number is available
IDENTIFICATION_Noise.vector_size = 3
IDENTIFICATION_Noise.minimum = NOISE_MIN; 
IDENTIFICATION_Noise.maximum = NOISE_MAX;
IDENTIFICATION_Noise.configure

### ADD Noise component ###
loadComponent("IDENTIFICATION_AddNoise","MATH::Addition")
addPeer("Supervisor","IDENTIFICATION_AddNoise")
IDENTIFICATION_AddNoise.vectorsize = 3
IDENTIFICATION_AddNoise.numberofinputs = 2
setActivity("IDENTIFICATION_AddNoise",0.0,HighestPriority,ORO_SCHED_RT)
IDENTIFICATION_AddNoise.configure

### TRACING COMPONENT ###
loadComponent("Tracing","Signal::Tracing")
addPeer("Supervisor","Tracing")
setActivity("Tracing",0.0,HighestPriority,ORO_SCHED_RT)
Tracing.vector_sizes = array (3.0, 3.0, 3.0) 
Tracing.buffersize = buffersize
Tracing.filename = "/tmp/"+FILENAME;
Tracing.Ts = Ts
Tracing.configure

### Disconnect and connect components ###
BASE_ReadReferences.out.disconnect()
connect ("IDENTIFICATION_Step.out",			"BASE_VelocityToPosition.in", ConnPolicy() );
BASE_Controller.out.disconnect();
connect ("BASE_Controller.out",				"IDENTIFICATION_AddNoise.in1_ev", ConnPolicy() );
connect ("IDENTIFICATION_Noise.out",		"IDENTIFICATION_AddNoise.in2", ConnPolicy() );
connect ("IDENTIFICATION_AddNoise.out",		"BASE_AddOffset.in1_ev", ConnPolicy() );
connect ("IDENTIFICATION_AddNoise.out",		"BASE_Diagnostics.vec3", ConnPolicy() );

### Connect tracing componenets ###
connect ("BASE_Controller.jointErrors",	"Tracing.in3", ConnPolicy() );
connect ("BASE_Controller.out",			"Tracing.in2", ConnPolicy() );
connect ("IDENTIFICATION_AddNoise.out",	"Tracing.in1", ConnPolicy() );

# safety and reference
Supervisor.AddEnabledPeer  	("IDENTIFICATION_Step",		BODYNUMBER)
Supervisor.AddEnabledPeer  	("IDENTIFICATION_Noise",	BODYNUMBER )
Supervisor.AddEnabledPeer  	("IDENTIFICATION_AddNoise",	BODYNUMBER )
Supervisor.AddEnabledPeer  	("Tracing",					BODYNUMBER )
